# 全球海缆拓扑可视化系统

**Global Submarine Cable Topology Visualization & Operations Support System**

> 一个开源的海缆拓扑可视化与运维辅助系统，基于 Vue.js + ECharts + Python 构建，旨在解决海缆故障定位模糊、运维流程繁琐、场景覆盖不足等行业痛点。通过多维度可视化、精准故障定位与打点测距，帮助运维人员快速定位故障、简化运维流程、支持故障处理闭环管理。

---

## 🎯 项目概述

本项目是一个**开源的海缆拓扑可视化与运维系统**，面向全球海缆运维从业者、技术研究者与开源社区开发者。系统提供海缆信息管理、拓扑可视化展示、故障精准定位、打点测距与运维流程辅助等功能，可灵活嵌入故障处理工作流。

**核心价值**：
- 故障定位精准化：支持沿海缆走线打点，实时测距，避免定位模糊
- 运维流程简化：多维筛选与聚焦，快速定位故障影响范围
- 可视化全景：2D/3D 一键切换，支持多套地图版本与纹理
- 开源可复用：技术栈通用，易于二次开发与集成

---

## ✨ 核心特性

### 可视化与交互

- **9大显示模式**：紧凑/大屏、2D普通/2D瓦片、3D地球、聚焦/打点/实况 — 覆盖不同使用场景
- **2D/3D视图**：平面图与地球模式一键切换，支持多套高清纹理（地形/白昼/夜光/8K）
- **智能聚焦**：海缆/登陆站双向聚焦，自动居中缩放；故障态聚焦含全量热力层叠加
- **高保真打点**：仅沿海缆走线打点，30km容差/80km容错，实时测距，绿线+预览点常驻
- **多维筛选**：权益类型、洲别、里程、状态快速过滤，支持拼音/括号搜索

### 故障管理与定位

- **故障全景监控**：故障列表按严重度排序，全量故障热力层，故障涉及实体快速追溯
- **精准打点测距**：支持沿海缆走线故障打点，实时计算距离与路径，支持预览与保存
- **故障闭环**：故障定位 → 编辑打点 → 保存经纬度 → 支持后续处理流程

### 布局与适配

- **布局持久化**：大屏三栏比例、紧凑抽屉宽度、浮动面板位置自动保存（localStorage）
- **响应式设计**：大屏模式（屏幕宽>3000px）与紧凑模式自动适配，拖拽分栏灵活调整
- **跨版本兼容**：亚太中心/标准版坐标自动转换，已保存定位点无需重新标注

## 🌏 3D 模式（地球视图）

- **默认视角与纹理**：
   - 默认朝向亚太区域（`viewControl.targetCoord = [120, 20]`），光照采用 `lambert` 柔和着色，开启后期 `postEffect` 与时间超采样以提升抗锯齿。
   - 自动加载并回退的多源纹理：基础地形（topo）与高度纹理（bathymetry）。
- **走线与分层**：
   - 海缆分两类渲染：`lines3D-base`（正常）与 `lines3D-fault`（故障），故障采用更醒目的红色并可根据聚焦态开启粒子尾迹（trail）。
   - 登陆站分两类渲染：`scatter3D-base`（常规站点）与 `scatter3D-fault`（故障涉及站点，菱形标记，标签附带里程）。
- **事件与交互**：
   - 完整复用 2D 的鼠标事件：`hover` 高亮海缆分段并显示 Tooltip，`click` 进入海缆或登陆站聚焦；3D 系列类型统一归一化（`lines3D/scatter3D`）确保事件覆盖。
   - 打点拾取坐标在 3D 场景使用 `convertFromPixel({ seriesIndex })`，在 2D 使用 `convertFromPixel({ geoIndex: 0 })`，避免访问不存在的 `geo.regions` 导致异常。
- **聚焦与视图控制**：
   - 海缆聚焦与登陆站聚焦都会计算中点/目标坐标，并在 3D 使用 `globe.viewControl.targetCoord` 居中；缩放滑条在 3D 直接映射为视距（`distance`）。
   - 支持自动旋转（`autoRotate`）与手动复位视角（清焦会重置视距与目标坐标）。
- **故障叠加层**：
   - 非聚焦时可叠加全量故障形成“故障热力层”，基础海缆/站点会降低透明度以便凸显故障；故障聚焦时优先展示目标段且不重复叠加。
- **重算与性能**：
   - 3D 海缆重算采用球面插值（步距可配置，默认 150 km），支持日期变更线跨越；优先加载已保存重算结果，必要时重算并持久化。
   - 系列采用适度透明与合理宽度，结合后期特效与抗锯齿以获得性能与观感平衡。
- **稳定性与重置**：
   - “全部重置”在 3D 下先销毁旧实例并抑制中途重绘，清焦/拾取坐标转换按 3D/2D 区分，避免 `geo.regions` 访问报错；随后重新加载数据并统一重绘。

### 3D 快速操作

- 右下控制台展开 → 切换“3D 地球” → 选择纹理（Topography/夜光等）→ 可打开“自动旋转”。
- 点击海缆或登陆站进入聚焦；打开“显示故障海缆叠加”可查看全局故障态势。
- 故障编辑面板点“打点”→ 在海缆线上悬停/点击，3D 下同样支持实时测距与预览。

## 🆕 近期亮点（跨会话汇总）

- **SJC 拐弯连通 + 打点交互加强（2026-01-26～2026-01-27，未提交）**：SJC 预览/打点统一兄弟分支几何，近邻连通分级兜底（5 km 小阈值→40/80/120 km 补边重算），空分段不覆盖基础数据；2D 聚焦缺少平面几何时回退球面拆段，故障标签序号稳定且结束时间缺省统一提示；故障备注输入自适应高度并可拖拽，紧凑/大屏编辑浮层禁用外击关闭；右下打点信息窗标题可拖拽、原生宽高调节并附 hover 提示，打点态 Speed Dial 仅保留“退出聚焦”，词典同步新提示。
- **打点浮窗调色盘与信息盒（2026-01-27，未提交）**：右下打点浮窗解除宽度上限，新增可持久化调色盘（背景/边框/文字/标题/阴影 + 透明度），独立浮层默认隐藏并可随时打开/关闭；打点字段精简（去除显隐开关与多余按钮），调色盘按钮置于“保存”前；距离/经纬度展示为随调色盘联动的亮色信息盒，标签去掉冒号，九模式（紧凑/大屏、2D/3D/瓦片、聚焦/打点/实况）视觉一致。
- **紧凑模式体验修复（2026-01-27～2026-01-28，未提交）**：海缆/登陆站列表补充故障徽标与“涉及故障/运行中”状态，故障列表空徽标自动隐藏；移除空的快捷开关占位，台湾文本归一避免重复替换；打点调色盘保存/恢复默认新增提示并接入词典；紧凑控制台收起按钮修复 overflow 裁剪，新增图标与渐变/阴影/hover 样式，并补齐“展开/收起控制台”词条，九模式保持一致。
- **瓦片 7 级与路径升级（2026-01-23）**：瓦片目录切换为 img/tiles_world_img 的 z/x/y 结构，最高级开放至 7 级；滚轮、按钮、缩放滑条与聚焦 clamp 统一 7 级上限，便于后续扩容更高精度瓦片。
- **全局 i18n 改造 + 紧凑修复（2026-01-23，未提交）**：词典去重并补齐国家/城市与按钮/选项翻译，紧凑海缆/故障详情按条切换语言，3D 故障标签与列表下拉（含“前 x 条”）全部完成 i18n；帮助弹窗与 README 版本里程碑同步。
- **Speed Dial 地图控制台**：右下主按钮 + 折叠面板，支持滚动与最大高度，适配小屏；紧凑模式标题/面板避免遮挡。
- **动画/特效分组**：新增“动画 / 特效”工具分组，走线流光默认关闭，需手动开启；开启后 2D/3D、聚焦/打点/实况均叠加流光尾迹，切换附带双段式 Loading 提示；登陆站起泡开关已移除，保留必要的故障/聚焦涟漪。
- **地图主题与光效升级**：2D 底色下拉支持灰阶/墨蓝/极光/沙岸/石板/霓虹六档主题，并新增多国配色三套，默认“灰色简约”，切换带 Loading 与进度提示；3D 光效提供总开关、风格下拉（标准/柔和/电影/正午/夜景）与亮度滑条，风格切换附加载进度，视角稳定。
- **概览与帮助优化**：顶部概览切换区域新增数值平滑动画与缓冲绑定，避免跳变且不影响底部统计；帮助弹窗新增 README 版本里程碑卡片与未来规划摘要，采用科技风卡片网格与路标标签。
- **坐标双向转换**：切换“亚太中心/标准版”时，已写入的故障定位点与 marker 自动转换；更新后自动居中焦点。
- **全屏切换稳定**：处于故障聚焦时采用“先退出聚焦→切换→再恢复”的流程，多次重绘避免地图空白；打点模式下退出全屏即退出打点。
- **默认紧凑模式**：首次加载默认紧凑（除非宽度>3000px）；搜索框进一步降高；控制台统计卡片美化与信息密度提升。
- **布局重绘增强**：拖拽分栏或模式切换后进行多次稳定重绘，地图尺寸/定位保持正确。

### 🔧 本次会话修复与改进（2026-01）

- 3D 视角稳定：
   - 鼠标移入走线不再自动回到亚太中心；仅在“首次进入 3D 且没有历史视角/显式 target”时以亚太为初始视角。
   - 首次进入 3D 时自动执行一次“聚焦第一条海缆→退出聚焦”，以保存一个稳定的相机视角（仅一次，不影响后续交互）。
   - 点击聚焦的中心点计算加入跨 180° 经线校正，跨太平洋等长线不再被错误居中到地中海。
- 3D 悬停与提示：
   - 悬停显示“小点提示”保持；线条加粗仅针对 3D 系列做局部样式刷新，避免整图重绘；Tooltip 在 hover 上可靠弹出。
- 2D 悬停加粗回归可控：
   - 限定“悬停局部改样式”只作用于 3D 线条，2D 仅使用 highlight/emphasis；修复了 2D 模式下反复移入导致线条越变越粗的问题。
- 交互性能：
   - 悬停不再触发全量 `updateChart`，仅执行必要的 `dispatchAction` + 3D 局部样式更新，提升流畅度。
- 3D 自转可调速：
   - 自转开关旁显示当前速度参数，开启后在下方出现滑条（0.2～5.0×，步进 0.1）实时调节 `autoRotateSpeed`，立即作用于 `globe.viewControl`。
   - 自转迟滞调整为 0.25 秒（`autoRotateAfterStill`），避免“慢半拍”启动；关闭自转时同样立即回写视角参数。
- 调试信息最小化：
   - 去除残余控制台输出（Toast 回退日志），仅保留必要提示与 UI Loading。
- 内部维护：
   - 统一故障左右布局相关注释格式，减少文字噪音，便于后续阅读维护。

### 📒 近期改动汇总（自 2026-01-16 提交后）

- **瓦片模式大幅增强（2026-01-20）**
   - 首屏自动检测小屏：未手动切换时直接进入“紧凑+瓦片”并分段 Loading（底图→海缆→登陆站→故障）；紧凑/大屏切换加入三段式进度提示。
   - 瓦片渲染稳定性：切入 tiles 会主动销毁 ECharts，3D 往返自动重建 TileMap，避免切回空白；图例移至左下角，按类别筛选叠加层。
   - 点线视觉优化：登陆站半径翻倍；故障涉及登陆站改为红粉色中号点；故障定位点使用红色定位 icon（比旧红点小 30%），即便隐藏登陆站也保留定位显示。
   - 交互补强：Speed Dial 增加“关闭实况”快捷键；瓦片 Tooltip、聚焦、流光/涟漪与主图一致。

- 2D 瓦片地图实验与增强：
   - 新增 tiles 地图版本（实验）：切换时由瓦片渲染器接管，支持鼠标滚轮 1-6 级缩放、按视口加载瓦片，离开时销毁实例恢复 ECharts。
   - 交互强化：滚轮缩放减速并与缩放滑条/按钮联动，支持拖拽漫游且经度循环，平移与缩放回推 UI 状态，叠加基础海缆线段与登陆站点。
   - 叠加层无缝铺满：点线叠加引入多重经度偏移，左右循环铺满视口，拖拽时无断裂。
   - 最高级 overzoom：在最高瓦片级别上继续放大最多 5 倍（可配置），无需为新增高等级瓦片改代码。

- 2D 聚焦居中与缩放修复：
   - 在 `ap-zh/标准版` 底图下统一按当前地图版本转换经纬度后计算聚焦中心；跨 180° 经线时做包络校正，防止跨洋线路居中偏移。
   - 在完整重绘后显式应用 `geo.center/zoom`，确保视觉居中与合适缩放（海缆/故障/登陆站聚焦均适用）。

- 3D 悬停回中心移除：
   - 新增一次性标记 `pendingFocusRecenter3D`，仅在进入聚焦的首帧应用 `globe.viewControl.targetCoord`；后续重绘保留用户当前视角，鼠标移入走线或球体不再触发“回亚太中心”。

- 3D 登陆站点击高亮：
   - 进入登陆站聚焦（3D）后，短暂叠加 1.2 秒的轻量“脉冲”高亮点，提升被点击站点可见性；2D 不受影响。

- 下拉样式统一与 Edge 兼容：
   - 全局下拉统一为深色科技风（深蓝底 + 霓光边 + 柔和内发光 + 自定义 SVG 箭头），移除“金属风”冲突样式，匹配大屏整体视觉。
   - 旧版 Edge(EdgeHTML) 不改动下拉框本体，仅提升 `option/optgroup` 的字号与对比度，改善选项可读性。

- 聚焦相关调试收敛：
   - 仅保留与聚焦/模式切换相关的 `focusDebug`；错误与异常用 `console.warn`，移除无关调试噪音。

- 标签显示策略优化：
   - 聚焦模式下基础登陆站标签默认隐藏，仅在故障存在定位时显示涉及登陆站标签；无定位点击时在地图中央弹出科技风提示并自动消失。

以上改动覆盖紧凑/大屏、2D/3D、聚焦/打点/实况八大模式，保持一致表现与体验。

- 图例（Legend）支持：
  - 支持 2D/3D 地图图例显示，中文系列名称：3D 包含“海缆/故障海缆/登陆站/故障定位点”；2D 按权益分组显示“海缆（自建/合建/租用/非权益/故障）”“登陆站（…）”。
  - 右下工具面板新增“显示图例/隐藏图例”开关按钮，动态切换无需重建图表。
   - 图例颜色与主题一致：图例小圆点颜色与各系列点/线的主题色严格对齐（3D：海缆/故障海缆/登陆站/故障定位点；2D：按权益分组的海缆与登陆站），避免认知偏差。
   - 进一步完善：
      - 2D：“海缆（故障）”统一使用红色；“故障定位点”与“故障涉及登陆站”分别独立控制，其颜色分别为橙色与红色；“海缆（非权益）”即使初始为空也保留可勾选项。
      - 3D：图例与 2D 同步（权益分组海缆/登陆站 + 故障定位点 + 故障涉及登陆站），图例/系列颜色完全一致。

   - 新增交互与样式：
      - 3D 故障海缆改为红色虚线显示，便于与正常海缆区分。
      - 故障定位点（1/2/3）以菱形呈现，默认展示标签；故障涉及登陆站使用红色涟漪气泡效果（2D），3D 中同步以红色高亮呈现并附加强调效果。

   - 后台提示方式优化：
         - “重算并保存（2D/3D）”状态提示从故障列表跑马灯迁移为屏幕右下角弹窗（5 秒自动消失）。
         - 使用 Element UI 的 Notification，定制科技风样式（半透明深色背景 + 蓝色描边与轻微光晕）。


- 首次加载进度提示：
   - 首次打开主地图时，主页 Loading 会逐步显示分阶段进度（中文）：
      1) 正在加载底图与脚本资源（首次加载稍慢）
      2) 正在加载海缆数据（数据量较大）
      3) 正在加载登陆站数据
      4) 正在检测并连接故障数据接口
      5) 正在加载故障数据
      6) 正在初始化图表并首次渲染
   - 完成后自动关闭（含兜底定时器），帮助用户理解“为什么这一步需要更久”。

- 首次进入 3D 的用户行为模拟与进度 Loading：
   - 仅在首次进入 3D 执行“聚焦可渲染的非故障海缆→退出聚焦→自动勾选【地图显示所有故障海缆信息】”。
   - 主地图显示 Loading 蒙层，并动态提示进度（进入 3D → 聚焦中 → 退出聚焦并开启故障叠加），模拟完成后自动关闭。

- **测距零偏差兜底**：投影命中 toLine=0 也判定在线，保证任意在线点都能出预览。
- **预览持久化**：悬停/点击生成的绿线+预览点+测距概览在鼠标离线时回退到最近一次有效打点。
- **数据预加载**：进入打点自动加载登陆站与海缆详情，紧凑模式下 Tooltip/测距稳定可用。
- **残留清理**：重新进入/退出/取消打点时清空旧路径与缓存，避免历史线段误导。
- **标题与蒙层优化**：标题强调“仅沿涉及海缆走线打点”；紧凑模式遮罩与关闭按钮层级修正。
- **Fault pick hover 修复**：多源坐标兜底（pixel/value/coords），紧凑模式不再只加粗虚线。

### 🆕 本次会话新增功能（2026-01-14）

- 登录/接口同源与弹窗升级：故障接口先自动探测可用 IP，再用同源地址请求 `dp6GetUserMessage` / `editFaultTable`；登录提示弹窗改为科技风样式，并在本窗口跳转“生产信息管理系统”。
- 故障详情补充修改者：大屏故障详情面板新增“最近一次修改者”字段并支持复制，已与紧凑/悬浮大窗保持一致。
- 实况脚本默认提速：PC/大屏实况脚本开启自转时默认速度提升至 10，兼容 2D/3D、聚焦/打点、紧凑/大屏模式。

- IAX 故障线路与海缆分支精准对齐：故障分支按几何签名去重并补齐同源兄弟分支；若 IAX 匹配分支不足会输出一次警告便于排查。
- 地图工具拨盘新增“重启”按钮（紧凑/大屏通用）：直达 `restartApp` 全局刷新，方便快速恢复默认布局状态。
- 关键操作按钮高亮：紧凑/大屏切换与 Agent 入口升级为 hero 渐变按钮，提升关键入口可见度。
- 双实况脚本：工具拨盘新增“开启 PC 实况模式 / 开启大屏实况模式”，按顺序执行全屏/退出全屏→切换 3D→退出聚焦→叠加所有故障→开启自转，并显示全屏 Loading 文案，兼容紧凑/大屏、2D/3D、聚焦/打点。
- 登录校验：首屏检查 `locationParam.account` 并调用 `/controlRoomPrivate/index.php/customer/dp6GetUserMessage` 校验用户；未传或用户不存在时，弹窗提示并提供一键打开 `controlRoomPrivate/index.php` 登录入口。

### ❓ 疑难问题需求记录

- IAX 故障线分支覆盖需持续监测：如仍存在分支缺失，请对比故障数据与海缆原始几何（id/name/feature_id）并收集日志。
- 若重启后布局仍异常，需确认本地存储是否被浏览器策略阻止，或检查是否有第三方脚本覆盖 `localStorage`。

## 🐞 顽固问题记录（瓦片版聚焦断截）

- 现象：tiles 瓦片模式下聚焦 `2Africa` 与 `India Asia Xpress (IAX)` 时，因多分段/多分支名称不一致，叠加层出现断截或仅显示部分分段。
- 解决思路：
   - 在瓦片聚焦分支复用主站 2D/3D 的聚合逻辑：
      - `2Africa`：按名称模糊匹配全部分段，聚合同名/同 id 分段再绘制；登陆站叠加统一去重。
      - `IAX`：对名称/feature_id/id 进行多重模糊匹配，并聚合同源分支，避免遗漏支线。
   - 叠加点加入站名标签，显示受“显示登陆站名”开关控制；故障/海缆/登陆站 tooltip 复用原有渲染逻辑，保证信息一致。
   - 视觉：走线默认带流光（dash+offset），点位带轻量涟漪，hover 时线条/点位透明度=1，尺寸放大 1.3 倍。
   - 兼容性：仅作用于 2D tiles，保持紧凑/大屏、聚焦/打点/实况链路一致。

### 🧾 小版本说明

- 本次小版本：2026.01.14-patch2
- 变更范围：IAX 故障分支匹配增强；地图工具拨盘新增全局重启；关键 CTA 按钮视觉强化；登录/接口同源与科技风弹窗；大屏故障详情补充“最近一次修改者”；实况脚本默认自转加速。

## 🪁 跷跷板问题（小版本说明）

- 现象：用 Copilot 解决问题 A 时触发问题 B，修复问题 B 又复现问题 A，形成 A/B 循环的“跷跷板”。
   - A 问题（具体）：鼠标每次移入海缆走线时，球体视角频繁回到“亚太中心”。
   - B 问题（具体）：“复位视角”与“开启自转”在部分场景下不生效。
- 应对：对 A/B 场景加 `modeSwitching` 锁与双帧 Loading，关闭自转时强制回写视角；自转速度滑条实时写入 `globe.viewControl`，迟滞缩短至 0.25s，降低互相打架概率。
- 新增提醒：3D 光效开关（bloom/大气）在频繁切换时可能再次触发 A/B 链路变成 A/B/C 跷跷板，切换前先确认视角已稳定，必要时关闭自转再切换。
- 记录：若再现 A/B 循环，请记录操作路径、时间与浏览器版本，便于复盘。

## 📥 快速开始

1. 准备静态服务：Nginx/Apache 或 `python -m http.server` 均可。
2. 部署目录：将项目放到 Web 根目录（示例 `/www/wwwroot/127.0.0.1/dp6/`）。
3. 访问：浏览器打开 `http://<server-ip>/dp6/index.html`。

## 🧭 使用指引

- **模式切换**：
   - 地图控制台采用右下角 **Speed Dial**：主按钮含 2D/3D 切换、全屏、工具总开关；展开的折叠面板提供复位视角、显示站名、缩放滑条、标题背景、2D 底图/3D 纹理选择、故障叠加层、2D 重算与地图版本选择。
- **筛选**：
  - 左侧（或紧凑面板）可勾选权益/类型/状态，洲别与里程下拉，支持“只选”快捷。
- **聚焦**：
  - 点击海缆或登陆站进入聚焦；故障列表点击聚焦故障段；再次点击退出。
- **打点**：
  - 在故障编辑面板点“打点”→悬停/点击海缆走线，绿线与测距实时刷新；点击写入后预览常驻，可继续或保存。
    - 打点悬停实时测距：返回预览点、距离、路径，离线时不返回结果（保持上一次有效预览）

## 🌐 开源部署与故障数据使用说明

- **免登录演示模式**：访问 URL 带 `developmode`（如 `index.html?developmode=1`）即可跳过生产登录校验，系统会写入默认用户，方便公网演示与本地评估。
- **故障数据兜底**：
   - 默认按“故障接口”下拉探测 OA/生产/本地接口，全部不可用时自动启用内置的 3 条演示故障数据，并提示“接口不可用，已切换演示故障数据”。
   - 工具入口“动画 / 特效”分组提供“开启/关闭演示故障”按钮，手动切换演示/真实；演示状态下仍缓存最近一次真实数据，关闭演示后自动恢复。
- **模式兼容性**：上述免登录与演示故障逻辑覆盖紧凑/大屏、2D/3D、聚焦/打点/实况 8 种场景，切换模式无需重复配置。
- **对接自有接口**：
   - 如需接入自有故障接口，按 `controlRoomPrivate/index.php/customer/cmccFaultPanelv2Agent?故障类型=海缆故障` 返回结构对齐当前字段（涉及海缆名称、故障点经纬度等）；接口可跨域但需同源鉴权时请关闭 `developmode`。
   - 接口不可用时建议保留演示兜底，确保公开展示时界面始终有数据。

## 📐 地图版本与坐标转换

- **可选版本**：`ap-zh`（亚太中心）、`std-zh`（标准版中文）、`std-en`（标准版英文）。
- **版本切换**：已写入的故障定位点与 marker 会在版本间自动转换；更新后自动居中当前焦点。
- **展示坐标**：列表与 Tooltip 中展示的坐标随当前版本映射，避免偏移。

## 🔁 模式切换稳定性

- **全屏切换**：若处于故障聚焦，采用“退出聚焦→切换→恢复聚焦”的流程，避免地图空白。
- **紧凑→大屏**：沿用同样的聚焦恢复策略，切换后地图保持正确显示。
- **打点退出**：打点模式下退出全屏等同退出打点，清理预览与路径。
- **重绘策略**：切换或拖拽分栏后执行分时多次重绘，确保容器尺寸与图层刷新。

## ⚙️ 默认设定与小屏适配
- **3D 海缆重算**：仅对“跨太平洋”线路执行球面插值（slerp）重算，自动跨越日期变更线连接，避免 3D 视图断线；默认加载 [seacable_data/重构的数据/3d海缆数据.json](dp6/seacable_data/重构的数据/3d海缆数据.json)，仅当选择“重算并保存”时更新。
- **3D 弧段步距**：控制球面插值的采样间隔（km），步距越小越平滑但点数越多，性能开销更大；步距越大越省资源但曲线略硬。默认 150 km，可选 100/150/200 km。
- **2D 海缆重算**：在 2D 模式下修复标准地图（以大西洋为中心）导致的日期变更线拆段问题，默认加载已保存版本，无文件则自动重算并保存两套数据（亚太中心/标准版）。

- **默认紧凑**：首次加载默认紧凑模式（除非屏幕宽度 > 3000px）。
- **Speed Dial 面板**：设定最大高度并支持滚动，避免小屏溢出。
- **标题适配**：紧凑模式下标题高度与字号下调，避免遮挡控件。
- **搜索框**：输入框内边距降至 3px，提升信息密度与对齐。

## 🗄 布局持久化（本地存储说明）
（主要面向开发者）

- 存储介质：浏览器 `localStorage`，无过期时间，直至用户主动“重置布局”、清理站点存储或更换浏览器/设备。
- 写入时机与键位：
   - `dp6.layout.screenCols`（对象 { l, c, r }，单位 %）：拖拽左右分隔条松手时写入，用于大屏三栏宽度。
   - `dp6.layout.leftPanePct`（数值 %）：列表区左右两列比例，拖拽竖向分隔条松手时写入。
   - `dp6.layout.topHeightPct`（数值 %）：列表区上下区域比例，拖拽横向分隔条松手时写入。
   - `dp6.layout.compactPanelWidth`（像素）：紧凑模式主抽屉宽度，拖拽抽屉右侧拉手松手时写入。
   - `dp6.fp.{cable|landing|fault}`（对象 { x,y,w,h }，像素）：浮动面板位置与尺寸，在拖动/缩放浮动面板后松手即写入。
- 恢复时机：主地图初始化阶段自动读取上述键位，按安全范围（最小/最大宽高、百分比上下限）回填布局，随后触发一次 `updateChart()` 确保渲染与布局同步。
- 清理方式：地图工具中的“重置布局”会移除上述所有键位并恢复默认比例（大屏三栏 16.7/50/32.7，列表左右 50%，上下 55%，紧凑宽 420px，浮动面板关闭），同时触发重绘。

## 🛠 打点模式要点

- 仅允许沿涉及海缆走线，偏移容差 30 km（宽容 80 km 兜底）。
- 起点必须是所选登陆站；若起点缺失会阻止打点。
- 悬停离线不清空，自动回退到最近一次有效打点；点击写入后预览锁定。
- 紧凑模式与大屏一致：绿线、预览点、测距概览 Tooltip 全部可见。

## 🧮 故障打点算法原理（概览）
（主要面向开发者）

- 核心目标：仅允许在目标海缆走线上打点，并返回“起点至打点位置”的沿线距离与路径，用于精确定位与态势联动。
- 关键流程：
   - 线路匹配：从所选海缆的折线段集合中，寻找与鼠标拾取坐标最近的合法线段，支持 30 km 容差（必要时 80 km 容错）。
   - 起点约束：若指定了登陆站起点，仅计算从该站到打点位置的路径；否则默认使用线路的自然起点。
   - 距离累计：
     - 使用 `distanceKm()`（Haversine）为图中的每条边赋权，包括：分段相邻点、近距离端点互连、起点/目标的投影点与端点连接、投影点自身切分出的局部子段。
     - `computeDistanceFromStart()` 将所有边权累加运行 Dijkstra，得到“登陆站起点 → 打点投影点”的最短沿线距离；返回路径坐标与 `distanceKm` 数值。
     - `computeDistanceAlongLine()` 作为外层包装，先用 30 km 偏移尝试（失败则 80 km 容错），确保仅在线上取点。
   - 3D 插值：跨太平洋等长线在 3D 下用球面插值（slerp）重构曲线，按步距（默认 150 km）采样，提升弧线与距离计算精度。
   - 日期变更线处理：在 2D 标准世界地图下（大西洋中心），对跨 180° 经线的折线进行连通修复，避免“断线/绕线”导致的距离误差。
- 坐标转换：在不同地图版本（亚太中心/标准版）间，对已保存的故障定位坐标与 marker 做双向转换，确保显示与计算一致。
- 结果输出：返回预览点坐标、沿线距离（km）、路径折线集合、目标线段索引与线路标识，用于 UI 高亮与 Tooltip 展示。

## 💡 进阶演示脚本

1) **故障溯源**：3D 夜光纹理 → 点击“重大故障” → 自动聚焦并展示故障信息。
2) **资产盘点**：2D 模式 → 仅选“自建” → 展示核心资产 → 点任意登陆站查看辐射海缆。

## 🧩 技术栈 （涉及多系统）
（主要面向开发者）

- 前端：Vue.js 2.x
- 后台：Python 3.x、Thinkphp5.1
- 可视化：ECharts 5.x + ECharts-GL 2.x
- UI：Element UI
- 语言：原生 JavaScript (ES6+)
- 容器：Docker

## 📂 目录速览
（主要面向开发者）

- `index.html`：页面骨架与大屏/紧凑模式结构。
- `css/app.css`：全局样式、布局、紧凑抽屉与地图叠层。
- `js/app.js`：业务逻辑、数据装饰、地图渲染、打点/测距、故障与筛选逻辑。
- `seacable_data/`：海缆与登陆站数据、纹理资源。

## 🚀 运行/调试
（主要面向开发者）

- 静态服务器直接打开，无需构建。
- 如需本地快速预览，可在项目根执行 `python -m http.server 8080`，浏览器访问 `http://localhost:8080/dp6/`。

## 🤝 贡献与反馈

- 欢迎提交 Issue/PR 讨论数据质量、交互优化与性能改进。
- 若在打点/测距、紧凑模式显示或 Tooltip 上遇到问题，请附带浏览器控制台日志与复现步骤。

## 🗒️ 版本说明

### 🌟 重要版本节点

1. **v1.0 响应式布局上线**（2025-12-01）
   - 实现大屏与紧凑模式的响应式布局切换。
   - 支持多分辨率适配与布局持久化。

2. **v1.5 2D 模式完成**（2025-12-15）
   - 完成 2D 地图模式，支持海缆与登陆站的基础渲染。
   - 增加筛选与聚焦功能。

3. **v2.0 打点算法上线**（2025-12-27）
   - 上线故障打点功能，支持沿线测距与路径计算。
   - 提供高精度的故障定位与态势联动。

4. **v2.5 3D 模式完成**（2026-01-05）
   - 完成 3D 地球模式，支持纹理切换与动态交互。
   - 增强故障叠加层与粒子尾迹效果。

5. **v3.0 空间换效率的后台布局**（2026-01-12）
   - 实现海缆数据的重算与保存功能。
   - 优化后台布局以提升性能与稳定性。

6. **v3.5  连接并融入生产信息系统生态，引入登录验证功能**（2026-01-15）
   - 引入登录验证并与生产信息系统生态融合。
   - 确保数据安全与系统稳定性。

- **v4.0 权限管理与审计（提前完成，目标 2026-Q2）**（2026-01-16）
   - 基于角色的权限模型（访客/运维/管理员/审计员），支持按功能、按数据域（区域/线路）授权。
   - 操作审计与事件溯源：登录、聚焦、打点、导出、实况切换等关键操作落日志，支持导出与告警。
   - 与生产信息系统单点集成（SSO/Token），确保演示/生产环境可切换。

- **v5.0 详细版世界地图（提前完成，目标 2026-Q3）**（2026-01-20）
   - 高分辨率瓦片与矢量混合：默认瓦片底图 + 精细矢量叠加，支持 overzoom 与经度循环，移动端友好。
   - 海缆/登陆站更精细的分层与样式：按类型/权益/故障状态独立图例与筛选；故障定位使用定位 icon 体系。
   - 性能与离线：按视口/区域懒加载数据，支持离线包与断网兜底；提供截图/录屏导出接口。

7. **v5.5 瓦片打点与全局深度优化**（2026-01-21）
   - 瓦片地图新增打点模式：瓦片叠加层支持故障打点、沿线测距与定位点回填，保持与 2D/3D 聚焦、打点、实况九模式一致。
   - 全局深度优化：首次进入 3D 的初始化流程拆分细化 Loading，模拟退出聚焦与勾选“显示所有故障海缆”；语言切换与标题/按钮 i18n 覆盖扩充。
   - 版本记录：对帮助入口与会话日志补充 v5.5 说明，便于后续追踪与回溯。

8. **v6.0 全局 i18n 改造与紧凑体验收敛**（2026-01-23）
   - 词典去重并补齐国家/城市、按钮与下拉选项翻译，覆盖 3D 故障标签与“前 x 条”列表等残留文案。
   - 紧凑面板常驻渲染修复，海缆/故障详情 per-item 语言切换与大屏一致，紧凑瓦片/列表文案同步翻译。
   - 帮助面板与 README 版本里程碑同步 v6.0，确保九模式与 i18n 统一口径。

9. **v6.5 瓦片地图 7 级升级**（2026-01-23）
   - 瓦片目录统一为 img/tiles_world_img 的 z/x/y 结构，默认资源开放至 7 级并保留 overzoom 兼容。
   - 滚轮、按钮、缩放滑条与聚焦 clamp 统一上限 7 级，叠加层与底图路径一致，便于继续扩容更高精度瓦片。

### 🔮 未来规划

- **v6.6 瓦片 8 级与离线包（计划 2026-Q2）**
   - 扩容更高等级瓦片并提供离线包/校验回退与加载监控，叠加层与底图路径保持一致，完善 overzoom 与资源健康检测。

- **v7.0 中国移动海陆缆系统（计划 2026-Q4）**
   - 汇聚中国移动海陆缆全量数据，强化登陆站、海缆、登陆点的详细属性与联动。
   - 预置国别/区域大屏模板与 KPI 看板，支持快速部署。

- **v8.0 AI 协同运维（计划 2027-Q1）**
   - 基于 LLM 的运维助手：支持自然语言下发聚焦/打点/实况指令，结合权限与审计。
   - 异常自愈提示：结合监控与故障历史，自动生成修复建议与路线回滚方案。

- **v9.0 海缆系统智能体（探索 2027-Q3 起）**
   - 邮件/文本投递自动生成故障打点、影响评估与修复计划草稿。
   - 支持自然语言交互与推荐，兼顾权限隔离与审计。

### 📋 版本定义与命名

- **主版本号**：功能性大更新（如新增模式、核心算法）。
- **次版本号**：功能增强或性能优化（如新增筛选条件、交互优化）。
- **修订号**：小范围修复（如 Bug 修复、样式调整）。

### 🛠 小版本更新记录
 
- **v3.0.1**（2025-12-01）：修复 3D 模式下的 Tooltip 异常。
- **v3.0.2**（2025-12-15）：优化故障叠加层的渲染性能。
- **v3.0.3**（2026-01-12）：增强布局持久化逻辑，修复部分浏览器兼容性问题。
- **v3.0.4**（2026-01-14）：自转速度上限提升并与滑条一致，工具面板自转滑条不再撑宽；跷跷板问题文档更新，提示记录操作链便于回溯。
